var fo=Object.defineProperty,co=Object.defineProperties;var ho=Object.getOwnPropertyDescriptors;var un=Object.getOwnPropertySymbols;var mo=Object.prototype.hasOwnProperty,go=Object.prototype.propertyIsEnumerable;var fn=(t,e,n)=>e in t?fo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Kt=(t,e)=>{for(var n in e||(e={}))mo.call(e,n)&&fn(t,n,e[n]);if(un)for(var n of un(e))go.call(e,n)&&fn(t,n,e[n]);return t},Ut=(t,e)=>co(t,ho(e));import{S as Je,i as Qe,n as Ze,P as ko,k as at,Q as po,f as L,F as lt,d as D,T as Lt,u as bo,e as Q,j as ne,c as Z,a as x,l as oe,b as Y,U as R,s as B,m as Le,o as K,p as je,q as X,w as me,x as ge,y as ke,L as ye,B as pe,V as Ct,W as $,X as rn,Y as On,Z as ae,J as U,_ as an,t as ue,g as fe,h as Fe,$ as cn,a0 as he,a1 as de,v as Rn,a2 as vo,a3 as Co,a4 as _o,a5 as Ln,a6 as hn,I as wo,a7 as yo}from"../../chunks/index-51808792.js";import{F as Ve,f as gt,a as So,p as ct,o as ht,b as Mo,c as Po,n as Fo,t as Do,d as Bo,e as Eo,g as Io,h as To,i as Ao,q as xt,j as $t}from"../../chunks/css-classes-406b94f9.js";import{p as qo}from"../../chunks/stores-ac37e759.js";import{d as Vo,i as zo,m as Bt,a as nt,b as Oo,E as kt,c as Ro,f as Lo,p as jo,e as No,g as Xe,o as st,s as pt,h as we,j as jt,F as Ie,k as en,l as jn,t as _t,n as tn,q as nn,R as Go,r as on,V as Et,B as He,u as dn,v as Mt,w as Ho,x as Xo,y as Wo,z as Yo,A as Ko,C as Jt,D as Uo,G as Jo,H as Qo,I as Zo,J as xo,K as $o,L as er,M as tr,N as nr,O as or,P as rr,Q as ir,S as ar}from"../../chunks/format-page-title-d2ff14dd.js";import{S as Nn,_ as Tt,a as bt,b as wt,c as lr,i as tt,O as Ye,n as ln,d as sr,B as At,e as Pe,w as ur}from"../../chunks/store-afb7c6c1.js";import{m as fr,g as Gn,a as Hn,c as vt,p as mn,o as Xn,f as gn,b as cr,i as Wn,d as hr,e as It}from"../../chunks/fullscreen-manager-1a6cf70b.js";import{r as ot,c as Yn,a as dr}from"../../chunks/use-click-outside-2182911f.js";import{t as Ue}from"../../chunks/tap-495987ce.js";import{d as kn}from"../../chunks/dialog-manager-2d1393e2.js";import"../../chunks/singletons-d1fb5791.js";const Kn=!0;var dt={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=dt.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new Nn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dt.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Tt([],bt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dt.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,Tt([],bt(t)))},delegate:void 0},mr=function(t){wt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Nn),qt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=qt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Tt([t,e],bt(n))):setInterval.apply(void 0,Tt([t,e],bt(n)))},clearInterval:function(t){var e=qt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Un=function(t){wt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),qt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;qt.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,lr(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(mr),pn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Vo.now,t}(),Jn=function(t){wt(e,t);function e(n,r){r===void 0&&(r=pn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(pn),Nt=new Jn(Un),gr=Nt,kr=function(t){wt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=dt.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(dt.cancelAnimationFrame(r),n._scheduled=void 0)},e}(Un),pr=function(t){wt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(Jn),Gt=new pr(kr);function br(t){return t instanceof Date&&!isNaN(t)}var vr=["addListener","removeListener"],Cr=["addEventListener","removeEventListener"],_r=["on","off"];function We(t,e,n,r){if(tt(n)&&(r=n,n=void 0),r)return We(t,e,n).pipe(fr(r));var o=bt(Sr(t)?Cr.map(function(l){return function(s){return t[l](e,s,n)}}):wr(t)?vr.map(bn(t,e)):yr(t)?_r.map(bn(t,e)):[],2),i=o[0],a=o[1];if(!i&&zo(t))return Bt(function(l){return We(l,e,n)})(nt(t));if(!i)throw new TypeError("Invalid event target");return new Ye(function(l){var s=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return l.next(1<u.length?u:u[0])};return i(s),function(){return a(s)}})}function bn(t,e){return function(n){return function(r){return t[n](e,r)}}}function wr(t){return tt(t.addListener)&&tt(t.removeListener)}function yr(t){return tt(t.on)&&tt(t.off)}function Sr(t){return tt(t.addEventListener)&&tt(t.removeEventListener)}function Ht(t,e,n){t===void 0&&(t=0),n===void 0&&(n=gr);var r=-1;return e!=null&&(Oo(e)?n=e:r=e),new Ye(function(o){var i=br(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Mr(t,e){return t===void 0&&(t=0),e===void 0&&(e=Nt),t<0&&(t=0),Ht(t,t,e)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=jo(t),r=No(t,1/0),o=t;return o.length?o.length===1?nt(o[0]):Ro(r)(Lo(o,n)):kt}var Qn=new Ye(ln),Pr=Array.isArray;function Fr(t){return t.length===1&&Pr(t[0])?t[0]:t}function Dr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Fr(t),t.length===1?nt(t[0]):new Ye(Br(t))}function Br(t){return function(e){for(var n=[],r=function(i){n.push(nt(t[i]).subscribe(Xe(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function Er(t){return st(function(e,n){var r=!1,o=null,i=null,a=function(){if(i==null||i.unsubscribe(),i=null,r){r=!1;var l=o;o=null,n.next(l)}};e.subscribe(Xe(n,function(l){i==null||i.unsubscribe(),r=!0,o=l,i=Xe(n,a,ln),nt(t(l)).subscribe(i)},function(){a(),n.complete()},void 0,function(){o=i=null}))})}function Vt(t,e){return e===void 0&&(e=Nt),st(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=i;i=null,r.next(u)}};function s(){var u=a+t,h=e.now();if(h<u){o=this.schedule(void 0,u-h),r.add(o);return}l()}n.subscribe(Xe(r,function(u){i=u,a=e.now(),o||(o=e.schedule(s,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function Zn(t,e){return e===void 0&&(e=sr),t=t!=null?t:Ir,st(function(n,r){var o,i=!0;n.subscribe(Xe(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Ir(t,e){return t===e}function Tr(){return st(function(t,e){var n,r=!1;t.subscribe(Xe(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function qe(t){return st(function(e,n){nt(t).subscribe(Xe(n,function(){return n.complete()},ln)),!n.closed&&e.subscribe(n)})}var xn={leading:!0,trailing:!1};function Ar(t,e){return e===void 0&&(e=xn),st(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,s=null,u=!1,h=function(){s==null||s.unsubscribe(),s=null,i&&(f(),u&&r.complete())},k=function(){s=null,u&&r.complete()},c=function(p){return s=nt(t(p)).subscribe(Xe(r,h,k))},f=function(){if(a){a=!1;var p=l;l=null,r.next(p),!u&&c(p)}};n.subscribe(Xe(r,function(p){a=!0,l=p,!(s&&!s.closed)&&(o?f():c(p))},function(){u=!0,!(i&&a&&s&&!s.closed)&&r.complete()}))})}function qr(t,e,n){e===void 0&&(e=Nt),n===void 0&&(n=xn);var r=Ht(t,e);return Ar(function(){return r},n)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const sn=new At([]),zt=new Pe,yt=new Pe,et=new Pe;function $n(t){const e=t.filter(i=>!i.parentChapter);let n=t.find(i=>i.progress<100);n||(n=t[t.length-1]);const r=n.parentChapter||n.reference,o=e.findIndex(i=>i.reference===r);return[e,o,r]}function Vr(t){let e,n;return{c(){e=new ko(!1),n=at(),this.h()},l(r){e=po(r,!1),n=at(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),L(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:lt,o:lt,d(r){r&&D(n),r&&e.d()}}}function zr(t,e,n){let{html:r}=e;const o=Lt();return bo(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class eo extends Je{constructor(e){super(),Qe(this,e,zr,Vr,Ze,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function rt(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Or{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=vn(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return vn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=rt(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function vn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Rr(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const Ot=Rr(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class to{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=Gn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Hn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=rt(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=this.getNodeBoundingRect(l),h=rt(this.verticalMode?s.left:s.bottom,this.direction)-r-o+e;this.paragraphPos[a]=h;const k=i.get(h)||[];i.set(h,k),k.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=Ot(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=Ot(this.accumulatedCharCount,e);return rt(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return rt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Lr(t,e,n){const r=Gr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!jr(o))return;const l=Nr(o,i,a);r(-l),o.preventDefault()}}function jr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function Nr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Gr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const s=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(i=t[r],a=t[r]),i+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Hr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Xr{constructor(e,n,r,o,i=Gt){this.multiplier=e,this.verticalMode=n,this.enabled$=new At(!1),this.enabled$.pipe(pt(a=>{if(!a)return kt;let l=0;return Mr(0,i).pipe(we(()=>Date.now()),Tr(),we(s=>this.calcNewPos(s)),we(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),jt(s=>s!==0))}),qe(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:Wr,window:Yr}=On;function Cn(t){let e,n,r,o,i;return{c(){e=Q("div"),r=ne(),o=Q("div"),this.h()},l(a){e=Z(a,"DIV",{class:!0,style:!0}),x(e).forEach(D),r=oe(a),o=Z(a,"DIV",{class:!0,style:!0}),x(o).forEach(D),this.h()},h(){Y(e,"class","fixed z-[5]"),Y(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][0]+": 0"),R(e,"inset-y-0",t[2]),R(e,"inset-x-0",!t[2]),B(e,"background-color",t[4],!1),Y(o,"class","fixed z-[5]"),Y(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][1]+": 0"),R(o,"inset-y-0",t[2]),R(o,"inset-x-0",!t[2]),B(o,"background-color",t[4],!1)},m(a,l){L(a,e,l),L(a,r,l),L(a,o,l)},p(a,l){l[0]&3686400&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][0]+": 0")&&Y(e,"style",n),l[0]&4&&R(e,"inset-y-0",a[2]),l[0]&4&&R(e,"inset-x-0",!a[2]),l[0]&16&&B(e,"background-color",a[4],!1),l[0]&3686400&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][1]+": 0")&&Y(o,"style",i),l[0]&4&&R(o,"inset-y-0",a[2]),l[0]&4&&R(o,"inset-x-0",!a[2]),l[0]&16&&B(o,"background-color",a[4],!1)},d(a){a&&D(e),a&&D(r),a&&D(o)}}}function _n(t){let e,n,r,o;const i=[Ur,Kr],a=[];function l(s,u){return s[2]?0:1}return e=l(t),n=a[e]=i[e](t),{c(){n.c(),r=at()},l(s){n.l(s),r=at()},m(s,u){a[e].m(s,u),L(s,r,u),o=!0},p(s,u){let h=e;e=l(s),e===h?a[e].p(s,u):(Le(),K(a[h],1,1,()=>{a[h]=null}),je(),n=a[e],n?n.p(s,u):(n=a[e]=i[e](s),n.c()),X(n,1),n.m(r.parentNode,r))},i(s){o||(X(n),o=!0)},o(s){K(n),o=!1},d(s){a[e].d(s),s&&D(r)}}}function Kr(t){let e,n,r;return n=new Ve({props:{icon:gt}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ge(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),B(e,"color",t[3],!1),B(e,"left",t[16],!1),B(e,"top",`calc(${t[17].top} + 1.5rem)`,!1)},m(o,i){L(o,e,i),ke(n,e,null),r=!0},p(o,i){i[0]&8&&B(e,"color",o[3],!1),i[0]&65536&&B(e,"left",o[16],!1),i[0]&131072&&B(e,"top",`calc(${o[17].top} + 1.5rem)`,!1)},i(o){r||(X(n.$$.fragment,o),r=!0)},o(o){K(n.$$.fragment,o),r=!1},d(o){o&&D(e),pe(n)}}}function Ur(t){let e,n,r;return n=new Ve({props:{icon:gt}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ge(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","pointer-events-none absolute text-xl opacity-25"),B(e,"color",t[3],!1),B(e,"right",`calc(${t[17].right} + 1rem)`,!1),B(e,"top",t[16],!1)},m(o,i){L(o,e,i),ke(n,e,null),r=!0},p(o,i){i[0]&8&&B(e,"color",o[3],!1),i[0]&131072&&B(e,"right",`calc(${o[17].right} + 1rem)`,!1),i[0]&65536&&B(e,"top",o[16],!1)},i(o){r||(X(n.$$.fragment,o),r=!0)},o(o){K(n.$$.fragment,o),r=!1},d(o){o&&D(e),pe(n)}}}function Jr(t){let e,n,r=`${t[7]}px`,o=`${t[18]||t[1]}px`,i,a,l,s,u,h;n=new eo({props:{html:t[0]}}),n.$on("load",t[24]);let k=t[14]&&Cn(t),c=t[17]&&_n(t);return{c(){e=Q("div"),me(n.$$.fragment),i=ne(),k&&k.c(),a=ne(),c&&c.c(),l=ne(),this.h()},l(f){e=Z(f,"DIV",{class:!0});var p=x(e);ge(n.$$.fragment,p),p.forEach(D),i=oe(f),k&&k.l(f),a=oe(f),c&&c.l(f),l=oe(f),this.h()},h(){Y(e,"class","book-content m-auto svelte-1tqbqao"),R(e,"book-content--writing-vertical-rl",t[2]),R(e,"book-content--writing-horizontal-rl",!t[2]),R(e,"book-content--hide-furigana",t[11]),R(e,"book-content--hide-spoiler-image",t[10]),R(e,"book-content--furigana-style-partial",t[12]===Ie.Partial),R(e,"book-content--furigana-style-full",t[12]===Ie.Full),R(e,"book-content--furigana-style-toggle",t[12]===Ie.Toggle),B(e,"color",t[3],!1),B(e,"font-size",r,!1),B(e,"max-width",!t[2]&&t[13]?`${t[13]}px`:void 0,!1),B(e,"max-height",t[18]?`${t[18]}px`:void 0,!1),B(e,"padding-left",t[2]&&t[14]?`${t[14]}px`:void 0,!1),B(e,"padding-right",t[2]&&t[14]?`${t[14]}px`:void 0,!1),B(e,"padding-top",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),B(e,"padding-bottom",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),B(e,"--font-family-serif",t[8],!1),B(e,"--font-family-sans-serif",t[9],!1),B(e,"--book-content-hint-furigana-font-color",t[5],!1),B(e,"--book-content-hint-furigana-shadow-color",t[6],!1),B(e,"--book-content-child-height",o,!1)},m(f,p){L(f,e,p),ke(n,e,null),t[41](e),L(f,i,p),k&&k.m(f,p),L(f,a,p),c&&c.m(f,p),L(f,l,p),s=!0,u||(h=[ye(Yr,"scroll",t[23]),ye(Wr.body,"wheel",t[22],{passive:!1})],u=!0)},p(f,p){const y={};p[0]&1&&(y.html=f[0]),n.$set(y),p[0]&4&&R(e,"book-content--writing-vertical-rl",f[2]),p[0]&4&&R(e,"book-content--writing-horizontal-rl",!f[2]),p[0]&2048&&R(e,"book-content--hide-furigana",f[11]),p[0]&1024&&R(e,"book-content--hide-spoiler-image",f[10]),p[0]&4096&&R(e,"book-content--furigana-style-partial",f[12]===Ie.Partial),p[0]&4096&&R(e,"book-content--furigana-style-full",f[12]===Ie.Full),p[0]&4096&&R(e,"book-content--furigana-style-toggle",f[12]===Ie.Toggle),p[0]&8&&B(e,"color",f[3],!1),p[0]&128&&r!==(r=`${f[7]}px`)&&B(e,"font-size",r,!1),p[0]&8196&&B(e,"max-width",!f[2]&&f[13]?`${f[13]}px`:void 0,!1),p[0]&262144&&B(e,"max-height",f[18]?`${f[18]}px`:void 0,!1),p[0]&16388&&B(e,"padding-left",f[2]&&f[14]?`${f[14]}px`:void 0,!1),p[0]&16388&&B(e,"padding-right",f[2]&&f[14]?`${f[14]}px`:void 0,!1),p[0]&16388&&B(e,"padding-top",!f[2]&&f[14]?`${f[14]}px`:void 0,!1),p[0]&16388&&B(e,"padding-bottom",!f[2]&&f[14]?`${f[14]}px`:void 0,!1),p[0]&256&&B(e,"--font-family-serif",f[8],!1),p[0]&512&&B(e,"--font-family-sans-serif",f[9],!1),p[0]&32&&B(e,"--book-content-hint-furigana-font-color",f[5],!1),p[0]&64&&B(e,"--book-content-hint-furigana-shadow-color",f[6],!1),p[0]&262146&&o!==(o=`${f[18]||f[1]}px`)&&B(e,"--book-content-child-height",o,!1),f[14]?k?k.p(f,p):(k=Cn(f),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),f[17]?c?(c.p(f,p),p[0]&131072&&X(c,1)):(c=_n(f),c.c(),X(c,1),c.m(l.parentNode,l)):c&&(Le(),K(c,1,1,()=>{c=null}),je())},i(f){s||(X(n.$$.fragment,f),X(c),s=!0)},o(f){K(n.$$.fragment,f),K(c),s=!1},d(f){f&&D(e),pe(n),t[41](null),f&&D(i),k&&k.d(f),f&&D(a),c&&c.d(f),f&&D(l),u=!1,Ct(h)}}}function Qr(t,e,n){let r,o,i,a,l;$(t,et,F=>n(47,l=F));let{htmlContent:s}=e,{width:u}=e,{height:h}=e,{verticalMode:k}=e,{fontColor:c}=e,{backgroundColor:f}=e,{hintFuriganaFontColor:p}=e,{hintFuriganaShadowColor:y}=e,{fontSize:d}=e,{fontFamilyGroupOne:S}=e,{fontFamilyGroupTwo:g}=e,{hideSpoilerImage:C}=e,{hideFurigana:w}=e,{furiganaStyle:q}=e,{secondDimensionMaxValue:A}=e,{firstDimensionMargin:I}=e,{autoPositionOnResize:j}=e,{autoBookmark:N}=e,{loadingState:J}=e,{multiplier:m}=e,{bookmarkData:E}=e,{exploredCharCount:v}=e,{bookCharCount:T}=e,{autoScroller:z}=e,{bookmarkManager:W}=e,{pageManager:O}=e;const te=Lt();let G,ee,M={},V,le,H,Ce,se,Se=0,ce=!1,ve=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem";const De=Lr(4,document.documentElement,requestAnimationFrame),Be=new Pe,Me=new Pe,_e=new Pe,be=new Map,ze=new Map;let Oe=0,Te=!1;rn(()=>{_e.next(),_e.complete()}),V=new Xr(m,k,_e,document),z=V,vt([Be,Me]).pipe(jt(()=>j),en(1),we(([F,ie])=>k?ie:F),Zn(),Vt(10),jn(Gt),qe(_e)).subscribe(()=>{if(!ee||!H)return;const F=ee.getScrollPosByCharCount(Se);ce=!0,H.scrollTo(F)});function xe(F){F.updateParagraphPos(),n(25,v=F.calcExploredCharCount()),se&&(se=!1,E.then(ie=>{!ie||!W||W.scrollToBookmark(ie)}).finally(()=>{N&&We(window,"scroll").pipe(en(1),Vt(3e3),qe(_e)).subscribe(()=>{te("bookmark")}),sn.pipe(_t(1),pt(ie=>ie.length?(ie.forEach(Ge=>{const Ee=Ge.reference,Re=document.getElementById(Ee);Re&&(Oe||(Oe=Number(getComputedStyle(Re)[k?"marginLeft":"marginBottom"].replace(/px$/,""))/2),ze.set(Ee,Ut(Kt({},Ge),{progress:0})),be.set(Ee,Re))}),be.size?(Ke(),We(window,"scroll")):kt):kt),Er(()=>Ht(Te?100:500)),qe(_e)).subscribe(Ke)})),n(37,M={})}function Ke(){const F=[...ze.entries()];for(let ie=0,{length:Ge}=F;ie<Ge;ie+=1){const[Ee,Re]=F[ie],b=be.get(Ee).getBoundingClientRect();Re.progress=k?Math.min(Math.max(b.right+(I||0)-window.innerWidth,0),b.width)/(b.width||1)*100:Math.abs(Math.min(Math.max(b.top-(I||0),-b.height),0))/(b.height||1)*100,ze.set(Ee,Re)}Te=!1,zt.next(ze)}function Ne(F){k&&!l&&De(F,d,window.innerWidth)}function $e(){requestAnimationFrame(()=>{!ee||(n(25,v=ee.calcExploredCharCount()),ce||(Se=v),ce=!1)})}function P(){!G||(n(36,ee=new to(G,k?"vertical":"horizontal",k?"rtl":"ltr",document.documentElement,document)),n(25,v=0),Se=v,n(26,T=ee.charCount),te("contentChange",G))}yt.pipe(qe(_e)).subscribe(F=>{let ie=document.getElementById(F);if(!ie)return;ie=!F.startsWith(mn)&&ie.closest(`div[id^="${mn}"]`)||ie,Te=!0;const Ee=ie.getBoundingClientRect();k?window.scrollBy(-(window.innerWidth-Ee.right-(I||0)-Oe),0):window.scrollBy(0,Ee.top-(I||0)-Oe)});function re(F){ae[F?"unshift":"push"](()=>{G=F,n(15,G)})}return t.$$set=F=>{"htmlContent"in F&&n(0,s=F.htmlContent),"width"in F&&n(30,u=F.width),"height"in F&&n(1,h=F.height),"verticalMode"in F&&n(2,k=F.verticalMode),"fontColor"in F&&n(3,c=F.fontColor),"backgroundColor"in F&&n(4,f=F.backgroundColor),"hintFuriganaFontColor"in F&&n(5,p=F.hintFuriganaFontColor),"hintFuriganaShadowColor"in F&&n(6,y=F.hintFuriganaShadowColor),"fontSize"in F&&n(7,d=F.fontSize),"fontFamilyGroupOne"in F&&n(8,S=F.fontFamilyGroupOne),"fontFamilyGroupTwo"in F&&n(9,g=F.fontFamilyGroupTwo),"hideSpoilerImage"in F&&n(10,C=F.hideSpoilerImage),"hideFurigana"in F&&n(11,w=F.hideFurigana),"furiganaStyle"in F&&n(12,q=F.furiganaStyle),"secondDimensionMaxValue"in F&&n(13,A=F.secondDimensionMaxValue),"firstDimensionMargin"in F&&n(14,I=F.firstDimensionMargin),"autoPositionOnResize"in F&&n(31,j=F.autoPositionOnResize),"autoBookmark"in F&&n(32,N=F.autoBookmark),"loadingState"in F&&n(33,J=F.loadingState),"multiplier"in F&&n(34,m=F.multiplier),"bookmarkData"in F&&n(35,E=F.bookmarkData),"exploredCharCount"in F&&n(25,v=F.exploredCharCount),"bookCharCount"in F&&n(26,T=F.bookCharCount),"autoScroller"in F&&n(27,z=F.autoScroller),"bookmarkManager"in F&&n(28,W=F.bookmarkManager),"pageManager"in F&&n(29,O=F.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(21,r=k?"height":"width"),t.$$.dirty[0]&4&&n(20,o=k?"width":"height"),t.$$.dirty[0]&4&&n(19,i=k?["left","right"]:["top","bottom"]),t.$$.dirty[0]&1073741824&&Be.next(u),t.$$.dirty[0]&2&&Me.next(h),t.$$.dirty[0]&8196&&n(18,a=k&&A?A:void 0),t.$$.dirty[0]&106500&&A&&G){const F=Number(getComputedStyle(G)[k?"marginTop":"marginRight"].replace(/px$/,""));n(16,ve=`min(max(calc(${`${F}px - ${ve}`}), ${ve}), ${F?`${F}px`:ve})`)}if(t.$$.dirty[0]&1&&s&&(se=!0),t.$$.dirty[0]&1073741826|t.$$.dirty[1]&36&&ee&&u&&h&&!J){const F=ee;requestAnimationFrame(()=>{xe(F)})}t.$$.dirty[0]&4|t.$$.dirty[1]&136&&V&&(n(38,V.multiplier=m,V),n(38,V.verticalMode=k,V)),t.$$.dirty[0]&16384|t.$$.dirty[1]&288&&ee&&(n(39,le=ee&&new Or(ee,window,I||0)),n(28,W=le)),t.$$.dirty[1]&336&&M&&(n(17,Ce=void 0),E.then(F=>{!F||n(17,Ce=le==null?void 0:le.getBookmarkBarPosition(F))})),t.$$.dirty[0]&16388|t.$$.dirty[1]&512&&(n(40,H=new Hr(k,I,window)),n(29,O=H))},[s,h,k,c,f,p,y,d,S,g,C,w,q,A,I,G,ve,Ce,a,i,o,r,Ne,$e,P,v,T,z,W,O,u,j,N,J,m,E,ee,M,V,le,H,re]}class Zr extends Je{constructor(e){super(),Qe(this,e,Qr,Jr,Ze,{htmlContent:0,width:30,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontSize:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,hideSpoilerImage:10,hideFurigana:11,furiganaStyle:12,secondDimensionMaxValue:13,firstDimensionMargin:14,autoPositionOnResize:31,autoBookmark:32,loadingState:33,multiplier:34,bookmarkData:35,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const xr="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function mt(t,e=Kn){return e?t():Qn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function $r(t){const e=Array.from(t.getElementsByTagName("img"));return new Ye(n=>{const r=e.filter(i=>i.src).map(ei);if(r.length<=0){n.next(!1),n.complete();return}const o=vt(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function ei(t){return t.complete?Xn(1):Dr(We(t,"load"),We(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ti(t,e){const n=ni(t),r=ri(t);return o=>Xt(n(o),oi(o,e),r(o))}function ni(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>Rt(o).pipe(Ue(()=>yt.next(o.hash.substring(1)))));return Xt(...r)}}function oi(t,e){const n=e===Ie.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?Rt(i).pipe(Ue(()=>{i.classList.toggle("reveal-rt")})):Rt(i).pipe(_t(1),Ue(()=>{i.classList.add("reveal-rt")})));return Xt(...o)}function ri(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),Rt(o).pipe(_t(1),Ue(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Xt(...r)}}function Rt(t){return We(t,"click").pipe(Ue(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const ii=300,ai=60,no="none";function ft(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function li(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function Pt(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function si(t,e,n,r,o,i=no){e.style.touchAction=i;let a=[];function l(u){a.push(u),Pt(e,t,u,a,"down"),r==null||r(a,u);const h=u.pointerId;function k(S){h===S.pointerId&&(a=li(S,a),a.length||c(),Pt(e,t,S,a,"up"),o==null||o(a,S))}function c(){f(),p(),y(),d()}const f=ft(e,"pointermove",S=>{a=a.map(g=>S.pointerId===g.pointerId?S:g),Pt(e,t,S,a,"move"),n==null||n(a,S)}),p=ft(e,"lostpointercapture",S=>{k(S)}),y=ft(e,"pointerup",S=>{k(S)}),d=ft(e,"pointerleave",S=>{a=[],c(),Pt(e,t,S,a,"up"),o==null||o(a,S)})}const s=ft(e,"pointerdown",l);return{destroy:()=>{s()}}}function ui(t,e={timeframe:ii,minSwipeDistance:ai,touchAction:no}){const n="swipe";let r,o,i,a;function l(u,h){o=h.clientX,i=h.clientY,r=Date.now(),u.length===1&&(a=h.target)}function s(u,h){if(h.type==="pointerup"&&u.length===0&&Date.now()-r<e.timeframe){const k=h.clientX-o,c=h.clientY-i,f=Math.abs(k),p=Math.abs(c);let y=null;f>=2*p&&f>e.minSwipeDistance?y=k>0?"right":"left":p>=2*f&&p>e.minSwipeDistance&&(y=c>0?"bottom":"top"),y&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:y,target:a}}))}}return si(n,t,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class fi{constructor(e,n,r,o,i,a,l,s,u,h,k){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=h,this.sectionRenderComplete$=k,this.translateX=0,this.sectionData=new Map,sn.pipe(_t(1)).subscribe(c=>{!c.length||(c.forEach(f=>{this.sectionData.set(f.reference,Ut(Kt({},f),{progress:0}))}),zt.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const k=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const c=this.translateX;k(),this.scrollToPos(-c-o,i);return}if(this.nextSection(i)){k();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),u=s+o*e,h=Math.ceil(u);if(h<a){if(s!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(h>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(u,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var r,o;this.scrollToPos(0,e),this.updateSectionData((r=this.sections[n-1])==null?void 0:r.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,r,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new Ye(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}updateSectionData(e,n,r=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let i=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:i?l.progress=0:l.progress=100,!i&&s&&(i=!0),this.sectionData.set(a.reference,l)}),r&&zt.next(this.sectionData)}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ci{constructor(e,n,r,o,i,a,l,s,u){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u,this.sectionIndex=-1;const h=c=>Gn(c).reduce((p,y)=>p+Hn(y),0);let k=0;this.sectionAccCharCounts=n.map(c=>(k+=h(c),k)),this.charCount=k}updateCurrentSection(e){this.calculator=new to(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return Ot(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=Ot(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const h=(y,d)=>y>=d?d:l[y]>u?y:h(y+1,d),k=s[h(a+1,l.length-1)],{screenSize:c}=this,f=this.verticalMode?-1:0,p=c*(Math.ceil(k/c)+f);return rt(p,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class hi{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function wn(t){let e,n,r;return n=new Ve({props:{icon:So,spin:!0}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ge(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),B(e,"color",t[4],!1),B(e,"background-color",t[5],!1)},m(o,i){L(o,e,i),ke(n,e,null),r=!0},p(o,i){i[0]&16&&B(e,"color",o[4],!1),i[0]&32&&B(e,"background-color",o[5],!1)},i(o){r||(X(n.$$.fragment,o),r=!0)},o(o){K(n.$$.fragment,o),r=!1},d(o){o&&D(e),pe(n)}}}function yn(t){let e,n,r;return n=new Ve({props:{icon:gt}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ge(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","fixed top-3 right-3 text-xl opacity-25"),B(e,"color",t[4],!1)},m(o,i){L(o,e,i),ke(n,e,null),r=!0},p(o,i){i[0]&16&&B(e,"color",o[4],!1)},i(o){r||(X(n.$$.fragment,o),r=!0)},o(o){K(n.$$.fragment,o),r=!1},d(o){o&&D(e),pe(n)}}}function di(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+it)/t[20]-it}px`,s,u,h,k,c,f;r=new eo({props:{html:t[19]}}),r.$on("load",t[21]);let p=!t[18]&&wn(t),y=t[0]&&yn(t);return{c(){e=Q("div"),n=Q("div"),me(r.$$.fragment),s=ne(),p&&p.c(),u=ne(),y&&y.c(),h=at(),this.h()},l(d){e=Z(d,"DIV",{class:!0});var S=x(e);n=Z(S,"DIV",{class:!0});var g=x(n);ge(r.$$.fragment,g),g.forEach(D),S.forEach(D),s=oe(d),p&&p.l(d),u=oe(d),y&&y.l(d),h=at(),this.h()},h(){Y(n,"class","book-content-container svelte-np4m3j"),Y(e,"class","book-content m-auto svelte-np4m3j"),R(e,"book-content--avoid-page-break",t[14]),R(e,"book-content--writing-vertical-rl",t[3]),R(e,"book-content--writing-horizontal-rl",!t[3]),R(e,"book-content--hide-furigana",t[12]),R(e,"book-content--hide-spoiler-image",t[11]),R(e,"book-content--furigana-style-partial",t[13]===Ie.Partial),R(e,"book-content--furigana-style-full",t[13]===Ie.Full),R(e,"book-content--furigana-style-toggle",t[13]===Ie.Toggle),B(e,"color",t[4],!1),B(e,"font-size",o,!1),B(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),B(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),B(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),B(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),B(e,"max-width",t[1]?`${t[1]}px`:void 0,!1),B(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0,!1),B(e,"--font-family-serif",t[9],!1),B(e,"--font-family-sans-serif",t[10],!1),B(e,"--book-content-hint-furigana-font-color",t[6],!1),B(e,"--book-content-hint-furigana-shadow-color",t[7],!1),B(e,"--book-content-child-width",i,!1),B(e,"--book-content-child-height",a,!1),B(e,"--book-content-column-count",t[20],!1),B(e,"--book-content-image-max-width",l,!1)},m(d,S){L(d,e,S),U(e,n),ke(r,n,null),t[37](n),t[38](e),L(d,s,S),p&&p.m(d,S),L(d,u,S),y&&y.m(d,S),L(d,h,S),k=!0,c||(f=[ye(window,"keydown",t[23]),an(ui.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),ye(e,"swipe",t[22])],c=!0)},p(d,S){const g={};S[0]&524288&&(g.html=d[19]),r.$set(g),S[0]&16384&&R(e,"book-content--avoid-page-break",d[14]),S[0]&8&&R(e,"book-content--writing-vertical-rl",d[3]),S[0]&8&&R(e,"book-content--writing-horizontal-rl",!d[3]),S[0]&4096&&R(e,"book-content--hide-furigana",d[12]),S[0]&2048&&R(e,"book-content--hide-spoiler-image",d[11]),S[0]&8192&&R(e,"book-content--furigana-style-partial",d[13]===Ie.Partial),S[0]&8192&&R(e,"book-content--furigana-style-full",d[13]===Ie.Full),S[0]&8192&&R(e,"book-content--furigana-style-toggle",d[13]===Ie.Toggle),S[0]&16&&B(e,"color",d[4],!1),S[0]&256&&o!==(o=`${d[8]}px`)&&B(e,"font-size",o,!1),S[0]&32776&&B(e,"padding-top",!d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&B(e,"padding-bottom",!d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&B(e,"padding-left",d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&B(e,"padding-right",d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&2&&B(e,"max-width",d[1]?`${d[1]}px`:void 0,!1),S[0]&12&&B(e,"max-height",d[3]&&d[2]?`${d[2]}px`:void 0,!1),S[0]&512&&B(e,"--font-family-serif",d[9],!1),S[0]&1024&&B(e,"--font-family-sans-serif",d[10],!1),S[0]&64&&B(e,"--book-content-hint-furigana-font-color",d[6],!1),S[0]&128&&B(e,"--book-content-hint-furigana-shadow-color",d[7],!1),S[0]&2&&i!==(i=`${d[1]}px`)&&B(e,"--book-content-child-width",i,!1),S[0]&4&&a!==(a=`${d[2]}px`)&&B(e,"--book-content-child-height",a,!1),S[0]&1048576&&B(e,"--book-content-column-count",d[20],!1),S[0]&1048586&&l!==(l=`${d[3]?d[1]:(d[1]+it)/d[20]-it}px`)&&B(e,"--book-content-image-max-width",l,!1),d[18]?p&&(Le(),K(p,1,1,()=>{p=null}),je()):p?(p.p(d,S),S[0]&262144&&X(p,1)):(p=wn(d),p.c(),X(p,1),p.m(u.parentNode,u)),d[0]?y?(y.p(d,S),S[0]&1&&X(y,1)):(y=yn(d),y.c(),X(y,1),y.m(h.parentNode,h)):y&&(Le(),K(y,1,1,()=>{y=null}),je())},i(d){k||(X(r.$$.fragment,d),X(p),X(y),k=!0)},o(d){K(r.$$.fragment,d),K(p),K(y),k=!1},d(d){d&&D(e),pe(r),t[37](null),t[38](null),d&&D(s),p&&p.d(d),d&&D(u),y&&y.d(d),d&&D(h),c=!1,Ct(f)}}}const Sn="overflow-hidden",it=20;function mi(t,e,n){let r,o;$(t,et,P=>n(42,o=P));let{htmlContent:i}=e,{width:a}=e,{height:l}=e,{verticalMode:s}=e,{fontColor:u}=e,{backgroundColor:h}=e,{hintFuriganaFontColor:k}=e,{hintFuriganaShadowColor:c}=e,{fontSize:f}=e,{fontFamilyGroupOne:p}=e,{fontFamilyGroupTwo:y}=e,{hideSpoilerImage:d}=e,{hideFurigana:S}=e,{furiganaStyle:g}=e,{loadingState:C}=e,{bookmarkData:w}=e,{pageManager:q}=e,{bookmarkManager:A}=e,{exploredCharCount:I}=e,{bookCharCount:j}=e,{isBookmarkScreen:N=!1}=e,{avoidPageBreak:J=!0}=e,{pageColumns:m}=e,{firstDimensionMargin:E}=e,{autoBookmark:v=!1}=e;const T=Lt();let z,W,O,te=[],G,ee,M,V=!1,le="",H=!0,Ce=0;const se=new Pe,Se=new Pe,ce=new At(-1),ve=new Pe,De=new At(0),Be=new Pe,Me=new Pe,_e=ce.pipe(we(P=>{var re;return((re=te[P])==null?void 0:re.innerHTML)||""})),be=new Pe;rn(()=>{document.body.classList.remove(Sn),be.next(),be.complete()}),vt([se,Se]).pipe(en(1),pt(()=>Me.pipe(_t(1))),qe(be)).subscribe(()=>{if(!O||!G)return;const P=O.getScrollPosByCharCount(Ce);P<0||G.scrollTo(P,!1)}),ve.pipe(qe(be)).subscribe(P=>{!O||(n(26,I=O.calcExploredCharCount()),P&&(Ce=I),w.then(Te))}),v&&ve.pipe(Vt(3e3),qe(be)).subscribe(P=>{P&&T("bookmark")}),_e.pipe(Zn(),qe(be)).subscribe(()=>{n(18,V=!1)}),_e.pipe(qe(be)).subscribe(P=>{const re=(F,ie)=>{if(ie===0){F();return}requestAnimationFrame(()=>re(F,ie-1))};re(()=>{n(19,le=P)},2)}),mt(()=>We(document.body,"wheel",{passive:!0})).pipe(qr(50),qe(be)).subscribe(P=>{if(!o){let re=(P.deltaX<0?-1:1)*(s?-1:1);P.deltaX||(re=P.deltaY<0?-1:1),G==null||G.flipPage(re)}});function ze(){if(H){H=!1;return}!z||(n(33,O=new ci(z,te,De,()=>a,()=>l,()=>it,s,z,document)),n(26,I=0),Ce=0,n(27,j=O.charCount),O.updateCurrentSection(ce.getValue()),T("contentChange",z))}function Oe(P){P.updateParagraphPos(),n(26,I=P.calcExploredCharCount()),Me.next(P),w.then(Te),M&&(M=!1,w.then(re=>{!re||!A||A.scrollToBookmark(re)})),n(18,V=!0)}function Te(P){const re=P==null?void 0:P.exploredCharCount;!O||!re||n(0,N=O.isCharOnScreen(re))}function xe(P){if(!G||o||P.detail.direction!=="left"&&P.detail.direction!=="right")return;const re=P.detail.direction==="left",F=s?!re:re;G.flipPage(F?1:-1)}function Ke(P){if(!(!G||o))switch(P.code){case"ArrowLeft":G[s?"nextPage":"prevPage"]();break;case"ArrowRight":G[s?"prevPage":"nextPage"]();break;case"ArrowUp":G.prevPage();break;case"ArrowDown":G.nextPage();break}}yt.pipe(qe(be)).subscribe(P=>{const re=te.findIndex(F=>F.id===P||F.querySelector(`[id="${P}"]`));re>-1&&(ce.next(re),G==null||G.scrollTo(0,!0))});function Ne(P){ae[P?"unshift":"push"](()=>{W=P,n(17,W)})}function $e(P){ae[P?"unshift":"push"](()=>{z=P,n(16,z)})}return t.$$set=P=>{"htmlContent"in P&&n(28,i=P.htmlContent),"width"in P&&n(1,a=P.width),"height"in P&&n(2,l=P.height),"verticalMode"in P&&n(3,s=P.verticalMode),"fontColor"in P&&n(4,u=P.fontColor),"backgroundColor"in P&&n(5,h=P.backgroundColor),"hintFuriganaFontColor"in P&&n(6,k=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&n(7,c=P.hintFuriganaShadowColor),"fontSize"in P&&n(8,f=P.fontSize),"fontFamilyGroupOne"in P&&n(9,p=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&n(10,y=P.fontFamilyGroupTwo),"hideSpoilerImage"in P&&n(11,d=P.hideSpoilerImage),"hideFurigana"in P&&n(12,S=P.hideFurigana),"furiganaStyle"in P&&n(13,g=P.furiganaStyle),"loadingState"in P&&n(29,C=P.loadingState),"bookmarkData"in P&&n(30,w=P.bookmarkData),"pageManager"in P&&n(24,q=P.pageManager),"bookmarkManager"in P&&n(25,A=P.bookmarkManager),"exploredCharCount"in P&&n(26,I=P.exploredCharCount),"bookCharCount"in P&&n(27,j=P.bookCharCount),"isBookmarkScreen"in P&&n(0,N=P.isBookmarkScreen),"avoidPageBreak"in P&&n(14,J=P.avoidPageBreak),"pageColumns"in P&&n(31,m=P.pageColumns),"firstDimensionMargin"in P&&n(15,E=P.firstDimensionMargin),"autoBookmark"in P&&n(32,v=P.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&1073741824&&w.then(Te),t.$$.dirty[0]&2&&a&&se.next(a),t.$$.dirty[0]&4&&l&&Se.next(l),t.$$.dirty[0]&10|t.$$.dirty[1]&1&&n(20,r=s?1:m||Math.ceil(a/1e3)),t.$$.dirty[0]&268435456&&i&&(M=!0),t.$$.dirty[0]&268435456){const P=document.createElement("div");P.innerHTML=i,n(34,te=Array.from(P.children)),ce.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&24&&W&&z&&te&&(n(35,G=new fi(W,z,te,ce,De,a,l,it,s,ve,Be)),n(24,q=G)),t.$$.dirty[0]&536870918|t.$$.dirty[1]&4&&O&&a&&l&&!C){const P=O;requestAnimationFrame(()=>{Oe(P)})}t.$$.dirty[0]&536870912|t.$$.dirty[1]&4&&O&&!C&&Be.next(ce.getValue()),t.$$.dirty[1]&52&&O&&G&&(n(36,ee=new hi(O,G,Me,ce,P=>Ce=P)),n(25,A=ee))},document.body.classList.add(Sn),[N,a,l,s,u,h,k,c,f,p,y,d,S,g,J,E,z,W,V,le,r,ze,xe,Ke,q,A,I,j,i,C,w,m,v,O,te,G,ee,Ne,$e]}class gi extends Je{constructor(e){super(),Qe(this,e,mi,di,Ze,{htmlContent:28,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:29,bookmarkData:30,pageManager:24,bookmarkManager:25,exploredCharCount:26,bookCharCount:27,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:31,firstDimensionMargin:15,autoBookmark:32},null,[-1,-1])}}function ki(t){var d,S;let e,n,r,o,i,a,l,s;function u(g){t[48](g)}function h(g){t[49](g)}function k(g){t[50](g)}function c(g){t[51](g)}function f(g){t[52](g)}function p(g){t[53](g)}let y={htmlContent:t[7],width:(d=t[28])!=null?d:0,height:200,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(S=t[30])!=null?S:!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(y.exploredCharCount=t[0]),t[1]!==void 0&&(y.bookCharCount=t[1]),t[6]!==void 0&&(y.isBookmarkScreen=t[6]),t[2]!==void 0&&(y.bookmarkData=t[2]),t[4]!==void 0&&(y.bookmarkManager=t[4]),t[5]!==void 0&&(y.pageManager=t[5]),e=new gi({props:y}),ae.push(()=>he(e,"exploredCharCount",u)),ae.push(()=>he(e,"bookCharCount",h)),ae.push(()=>he(e,"isBookmarkScreen",k)),ae.push(()=>he(e,"bookmarkData",c)),ae.push(()=>he(e,"bookmarkManager",f)),ae.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[54]),e.$on("bookmark",t[55]),{c(){me(e.$$.fragment)},l(g){ge(e.$$.fragment,g)},m(g,C){ke(e,g,C),s=!0},p(g,C){var q,A;const w={};C[0]&128&&(w.htmlContent=g[7]),C[0]&268435456&&(w.width=(q=g[28])!=null?q:0),C[0]&256&&(w.verticalMode=g[8]),C[0]&512&&(w.fontColor=g[9]),C[0]&1024&&(w.backgroundColor=g[10]),C[0]&2048&&(w.hintFuriganaFontColor=g[11]),C[0]&4096&&(w.hintFuriganaShadowColor=g[12]),C[0]&8192&&(w.fontSize=g[13]),C[0]&16384&&(w.fontFamilyGroupOne=g[14]),C[0]&32768&&(w.fontFamilyGroupTwo=g[15]),C[0]&65536&&(w.hideSpoilerImage=g[16]),C[0]&131072&&(w.hideFurigana=g[17]),C[0]&262144&&(w.furiganaStyle=g[18]),C[0]&1073741824&&(w.loadingState=(A=g[30])!=null?A:!0),C[0]&4194304&&(w.avoidPageBreak=g[22]),C[0]&8388608&&(w.pageColumns=g[23]),C[0]&16777216&&(w.autoBookmark=g[24]),C[0]&1048576&&(w.firstDimensionMargin=g[20]),!n&&C[0]&1&&(n=!0,w.exploredCharCount=g[0],de(()=>n=!1)),!r&&C[0]&2&&(r=!0,w.bookCharCount=g[1],de(()=>r=!1)),!o&&C[0]&64&&(o=!0,w.isBookmarkScreen=g[6],de(()=>o=!1)),!i&&C[0]&4&&(i=!0,w.bookmarkData=g[2],de(()=>i=!1)),!a&&C[0]&16&&(a=!0,w.bookmarkManager=g[4],de(()=>a=!1)),!l&&C[0]&32&&(l=!0,w.pageManager=g[5],de(()=>l=!1)),e.$set(w)},i(g){s||(X(e.$$.fragment,g),s=!0)},o(g){K(e.$$.fragment,g),s=!1},d(g){pe(e,g)}}}function pi(t){var d,S,g;let e,n,r,o,i,a,l,s;function u(C){t[40](C)}function h(C){t[41](C)}function k(C){t[42](C)}function c(C){t[43](C)}function f(C){t[44](C)}function p(C){t[45](C)}let y={htmlContent:t[7],width:(d=t[28])!=null?d:0,height:(S=t[29])!=null?S:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:(g=t[30])!=null?g:!0};return t[0]!==void 0&&(y.exploredCharCount=t[0]),t[1]!==void 0&&(y.bookCharCount=t[1]),t[2]!==void 0&&(y.bookmarkData=t[2]),t[3]!==void 0&&(y.autoScroller=t[3]),t[4]!==void 0&&(y.bookmarkManager=t[4]),t[5]!==void 0&&(y.pageManager=t[5]),e=new Zr({props:y}),ae.push(()=>he(e,"exploredCharCount",u)),ae.push(()=>he(e,"bookCharCount",h)),ae.push(()=>he(e,"bookmarkData",k)),ae.push(()=>he(e,"autoScroller",c)),ae.push(()=>he(e,"bookmarkManager",f)),ae.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[46]),e.$on("bookmark",t[47]),{c(){me(e.$$.fragment)},l(C){ge(e.$$.fragment,C)},m(C,w){ke(e,C,w),s=!0},p(C,w){var A,I,j;const q={};w[0]&128&&(q.htmlContent=C[7]),w[0]&268435456&&(q.width=(A=C[28])!=null?A:0),w[0]&536870912&&(q.height=(I=C[29])!=null?I:0),w[0]&256&&(q.verticalMode=C[8]),w[0]&512&&(q.fontColor=C[9]),w[0]&1024&&(q.backgroundColor=C[10]),w[0]&2048&&(q.hintFuriganaFontColor=C[11]),w[0]&4096&&(q.hintFuriganaShadowColor=C[12]),w[0]&8192&&(q.fontSize=C[13]),w[0]&16384&&(q.fontFamilyGroupOne=C[14]),w[0]&32768&&(q.fontFamilyGroupTwo=C[15]),w[0]&65536&&(q.hideSpoilerImage=C[16]),w[0]&131072&&(q.hideFurigana=C[17]),w[0]&262144&&(q.furiganaStyle=C[18]),w[0]&524288&&(q.secondDimensionMaxValue=C[19]),w[0]&1048576&&(q.firstDimensionMargin=C[20]),w[0]&2097152&&(q.autoPositionOnResize=C[21]),w[0]&16777216&&(q.autoBookmark=C[24]),w[0]&67108864&&(q.multiplier=C[26]),w[0]&1073741824&&(q.loadingState=(j=C[30])!=null?j:!0),!n&&w[0]&1&&(n=!0,q.exploredCharCount=C[0],de(()=>n=!1)),!r&&w[0]&2&&(r=!0,q.bookCharCount=C[1],de(()=>r=!1)),!o&&w[0]&4&&(o=!0,q.bookmarkData=C[2],de(()=>o=!1)),!i&&w[0]&8&&(i=!0,q.autoScroller=C[3],de(()=>i=!1)),!a&&w[0]&16&&(a=!0,q.bookmarkManager=C[4],de(()=>a=!1)),!l&&w[0]&32&&(l=!0,q.pageManager=C[5],de(()=>l=!1)),e.$set(q)},i(C){s||(X(e.$$.fragment,C),s=!0)},o(C){K(e.$$.fragment,C),s=!1},d(C){pe(e,C)}}}function bi(t){var k;let e,n,r,o,i=((k=t[31])!=null?k:"")+"",a,l;const s=[pi,ki],u=[];function h(c,f){return c[25]===Et.Continuous?0:1}return n=h(t),r=u[n]=s[n](t),{c(){e=Q("div"),r.c(),o=ne(),a=ue(i),this.h()},l(c){e=Z(c,"DIV",{class:!0});var f=x(e);r.l(f),f.forEach(D),o=oe(c),a=fe(c,i),this.h()},h(){Y(e,"class",xr+" py-8")},m(c,f){L(c,e,f),u[n].m(e,null),t[56](e),L(c,o,f),L(c,a,f),l=!0},p(c,f){var y;let p=n;n=h(c),n===p?u[n].p(c,f):(Le(),K(u[p],1,1,()=>{u[p]=null}),je(),r=u[n],r?r.p(c,f):(r=u[n]=s[n](c),r.c()),X(r,1),r.m(e,null)),(!l||f[1]&1)&&i!==(i=((y=c[31])!=null?y:"")+"")&&Fe(a,i)},i(c){l||(X(r),l=!0)},o(c){K(r),l=!1},d(c){c&&D(e),u[n].d(),t[56](null),c&&D(o),c&&D(a)}}}function Ft(t){return Number(t.replace(/px$/,""))}function vi(t,e,n){let r,o,i,a,l,s,{htmlContent:u}=e,{width:h}=e,{height:k}=e,{verticalMode:c}=e,{fontColor:f}=e,{backgroundColor:p}=e,{hintFuriganaFontColor:y}=e,{hintFuriganaShadowColor:d}=e,{fontSize:S}=e,{fontFamilyGroupOne:g}=e,{fontFamilyGroupTwo:C}=e,{hideSpoilerImage:w}=e,{hideFurigana:q}=e,{furiganaStyle:A}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:j}=e,{autoPositionOnResize:N}=e,{avoidPageBreak:J}=e,{pageColumns:m}=e,{autoBookmark:E}=e,{viewMode:v}=e,{exploredCharCount:T}=e,{bookCharCount:z}=e,{multiplier:W}=e,{bookmarkData:O}=e,{autoScroller:te}=e,{bookmarkManager:G}=e,{pageManager:ee}=e,{isBookmarkScreen:M}=e;const V=new Pe,le=new Pe,H=ur(null);$(t,H,b=>n(27,o=b));const Ce=vt([H.pipe(jt(b=>!!b)),vt([V,le]).pipe(tn(0))]).pipe(Vt(0,Gt),we(([b])=>getComputedStyle(b)),nn({refCount:!0,bufferSize:1})),se=new Go(1),Se=Ce.pipe(we(b=>Be(h-Ft(b.paddingLeft)-Ft(b.paddingRight))));$(t,Se,b=>n(28,i=b));const ce=Ce.pipe(we(b=>Me(k-Ft(b.paddingTop)-Ft(b.paddingBottom)-r)));$(t,ce,b=>n(29,a=b));const ve=mt(()=>Xn(document)).pipe(Bt(b=>{const Wt=ti(b,A);return se.pipe(Bt(Yt=>Wt(Yt)))}),ot());$(t,ve,b=>n(31,s=b));const De=se.pipe(Bt(b=>$r(b)),on());$(t,De,b=>n(30,l=b));function Be(b){return Et.Paginated===v&&!c&&I?Math.min(I,b):b}function Me(b){return Et.Paginated===v&&c&&I?Math.min(I,b):b}function _e(b){T=b,n(0,T)}function be(b){z=b,n(1,z)}function ze(b){O=b,n(2,O)}function Oe(b){te=b,n(3,te)}function Te(b){G=b,n(4,G)}function xe(b){ee=b,n(5,ee)}const Ke=b=>se.next(b.detail);function Ne(b){cn.call(this,t,b)}function $e(b){T=b,n(0,T)}function P(b){z=b,n(1,z)}function re(b){M=b,n(6,M)}function F(b){O=b,n(2,O)}function ie(b){G=b,n(4,G)}function Ge(b){ee=b,n(5,ee)}const Ee=b=>se.next(b.detail);function Re(b){cn.call(this,t,b)}function St(b){ae[b?"unshift":"push"](()=>{o=b,H.set(o)})}return t.$$set=b=>{"htmlContent"in b&&n(7,u=b.htmlContent),"width"in b&&n(38,h=b.width),"height"in b&&n(39,k=b.height),"verticalMode"in b&&n(8,c=b.verticalMode),"fontColor"in b&&n(9,f=b.fontColor),"backgroundColor"in b&&n(10,p=b.backgroundColor),"hintFuriganaFontColor"in b&&n(11,y=b.hintFuriganaFontColor),"hintFuriganaShadowColor"in b&&n(12,d=b.hintFuriganaShadowColor),"fontSize"in b&&n(13,S=b.fontSize),"fontFamilyGroupOne"in b&&n(14,g=b.fontFamilyGroupOne),"fontFamilyGroupTwo"in b&&n(15,C=b.fontFamilyGroupTwo),"hideSpoilerImage"in b&&n(16,w=b.hideSpoilerImage),"hideFurigana"in b&&n(17,q=b.hideFurigana),"furiganaStyle"in b&&n(18,A=b.furiganaStyle),"secondDimensionMaxValue"in b&&n(19,I=b.secondDimensionMaxValue),"firstDimensionMargin"in b&&n(20,j=b.firstDimensionMargin),"autoPositionOnResize"in b&&n(21,N=b.autoPositionOnResize),"avoidPageBreak"in b&&n(22,J=b.avoidPageBreak),"pageColumns"in b&&n(23,m=b.pageColumns),"autoBookmark"in b&&n(24,E=b.autoBookmark),"viewMode"in b&&n(25,v=b.viewMode),"exploredCharCount"in b&&n(0,T=b.exploredCharCount),"bookCharCount"in b&&n(1,z=b.bookCharCount),"multiplier"in b&&n(26,W=b.multiplier),"bookmarkData"in b&&n(2,O=b.bookmarkData),"autoScroller"in b&&n(3,te=b.autoScroller),"bookmarkManager"in b&&n(4,G=b.bookmarkManager),"pageManager"in b&&n(5,ee=b.pageManager),"isBookmarkScreen"in b&&n(6,M=b.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=j&&Et.Paginated===v&&!c?j*2:0),t.$$.dirty[1]&128&&V.next(h),t.$$.dirty[1]&256&&le.next(k)},[T,z,O,te,G,ee,M,u,c,f,p,y,d,S,g,C,w,q,A,I,j,N,J,m,E,v,W,o,i,a,l,s,H,se,Se,ce,ve,De,h,k,_e,be,ze,Oe,Te,xe,Ke,Ne,$e,P,re,F,ie,Ge,Ee,Re,St]}class Ci extends Je{constructor(e){super(),Qe(this,e,vi,bi,Ze,{htmlContent:7,width:38,height:39,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function _i(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function wi(t,e,n){let{styleSheet:r}=e,o;return Rn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),rn(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&_i(o,r)},[r,o]}class yi extends Je{constructor(e){super(),Qe(this,e,wi,null,Ze,{styleSheet:0})}}function Mn(t){let e,n,r,o,i,a;return n=new Ve({props:{icon:Bo}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(l){e=Z(l,"DIV",{class:!0,role:!0});var s=x(e);ge(n.$$.fragment,s),s.forEach(D),this.h()},h(){Y(e,"class",r="flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),Y(e,"role","button")},m(l,s){L(l,e,s),ke(n,e,null),o=!0,i||(a=ye(e,"click",t[5]),i=!0)},p:lt,i(l){o||(X(n.$$.fragment,l),o=!0)},o(l){K(n.$$.fragment,l),o=!1},d(l){l&&D(e),pe(n),i=!1,a()}}}function Pn(t){let e,n,r,o,i,a;return n=new Ve({props:{icon:Eo}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(l){e=Z(l,"DIV",{role:!0,class:!0});var s=x(e);ge(n.$$.fragment,s),s.forEach(D),this.h()},h(){Y(e,"role","button"),Y(e,"class",r="flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer")},m(l,s){L(l,e,s),ke(n,e,null),o=!0,i||(a=ye(e,"click",t[7]),i=!0)},p:lt,i(l){o||(X(n.$$.fragment,l),o=!0)},o(l){K(n.$$.fragment,l),o=!1},d(l){l&&D(e),pe(n),i=!1,a()}}}function Si(t){let e,n,r,o,i,a,l,s,u,h,k,c,f,p,y,d,S,g,C,w,q,A,I=t[0]&&Mn(t);i=new Ve({props:{icon:t[3]?gt:gn}});let j=t[2]&&Pn(t);return y=new Ve({props:{icon:Mo}}),C=new Ve({props:{icon:Po}}),{c(){e=Q("div"),n=Q("div"),I&&I.c(),r=ne(),o=Q("div"),me(i.$$.fragment),a=ne(),l=Q("div"),s=ue(t[1]),u=ue("x"),h=ne(),k=Q("div"),j&&j.c(),c=ne(),f=Q("a"),p=Q("span"),me(y.$$.fragment),d=ne(),S=Q("a"),g=Q("span"),me(C.$$.fragment),this.h()},l(N){e=Z(N,"DIV",{class:!0});var J=x(e);n=Z(J,"DIV",{class:!0});var m=x(n);I&&I.l(m),r=oe(m),o=Z(m,"DIV",{class:!0,role:!0});var E=x(o);ge(i.$$.fragment,E),E.forEach(D),a=oe(m),l=Z(m,"DIV",{class:!0});var v=x(l);s=fe(v,t[1]),u=fe(v,"x"),v.forEach(D),m.forEach(D),h=oe(J),k=Z(J,"DIV",{class:!0});var T=x(k);j&&j.l(T),c=oe(T),f=Z(T,"A",{href:!0});var z=x(f);p=Z(z,"SPAN",{class:!0});var W=x(p);ge(y.$$.fragment,W),W.forEach(D),z.forEach(D),d=oe(T),S=Z(T,"A",{href:!0});var O=x(S);g=Z(O,"SPAN",{class:!0});var te=x(g);ge(C.$$.fragment,te),te.forEach(D),O.forEach(D),T.forEach(D),J.forEach(D),this.h()},h(){Y(o,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),Y(o,"role","button"),Y(l,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),Y(n,"class","flex transform-gpu "+Fo),Y(p,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),Y(f,"href","/settings"),Y(g,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),Y(S,"href","/manage"),Y(k,"class","flex transform-gpu "+Do),Y(e,"class","flex h-12 justify-between bg-gray-700 px-4 text-white md:px-8 xl:h-10")},m(N,J){L(N,e,J),U(e,n),I&&I.m(n,null),U(n,r),U(n,o),ke(i,o,null),U(n,a),U(n,l),U(l,s),U(l,u),U(e,h),U(e,k),j&&j.m(k,null),U(k,c),U(k,f),U(f,p),ke(y,p,null),U(k,d),U(k,S),U(S,g),ke(C,g,null),w=!0,q||(A=[ye(o,"click",t[6]),ye(f,"click",t[8]),ye(S,"click",t[9])],q=!0)},p(N,[J]){N[0]?I?(I.p(N,J),J&1&&X(I,1)):(I=Mn(N),I.c(),X(I,1),I.m(n,r)):I&&(Le(),K(I,1,1,()=>{I=null}),je());const m={};J&8&&(m.icon=N[3]?gt:gn),i.$set(m),(!w||J&2)&&Fe(s,N[1]),N[2]?j?(j.p(N,J),J&4&&X(j,1)):(j=Pn(N),j.c(),X(j,1),j.m(k,c)):j&&(Le(),K(j,1,1,()=>{j=null}),je())},i(N){w||(X(I),X(i.$$.fragment,N),X(j),X(y.$$.fragment,N),X(C.$$.fragment,N),w=!0)},o(N){K(I),K(i.$$.fragment,N),K(j),K(y.$$.fragment,N),K(C.$$.fragment,N),w=!1},d(N){N&&D(e),I&&I.d(),pe(i),j&&j.d(),pe(y),pe(C),q=!1,Ct(A)}}}function Mi(t,e,n){let{hasChapterData:r}=e,{autoScrollMultiplier:o}=e,{showFullscreenButton:i}=e,{isBookmarkScreen:a}=e;const l=Lt(),s=()=>l("tocClick"),u=()=>l("bookmarkClick"),h=()=>l("fullscreenClick"),k=()=>l("settingsClick"),c=()=>l("bookManagerClick");return t.$$set=f=>{"hasChapterData"in f&&n(0,r=f.hasChapterData),"autoScrollMultiplier"in f&&n(1,o=f.autoScrollMultiplier),"showFullscreenButton"in f&&n(2,i=f.showFullscreenButton),"isBookmarkScreen"in f&&n(3,a=f.isBookmarkScreen)},[r,o,i,a,l,s,u,h,k,c]}class Pi extends Je{constructor(e){super(),Qe(this,e,Mi,Si,Ze,{hasChapterData:0,autoScrollMultiplier:1,showFullscreenButton:2,isBookmarkScreen:3})}}function Fn(t,e,n){const r=t.slice();return r[15]=e[n],r}function Dn(t,e){let n,r,o=e[15].label+"",i,a,l,s,u=e[15].startCharacter+"",h,k,c,f;function p(){return e[12](e[15])}return{key:t,first:null,c(){n=Q("div"),r=Q("div"),i=ue(o),l=ne(),s=Q("div"),h=ue(u),k=ne(),this.h()},l(y){n=Z(y,"DIV",{class:!0});var d=x(n);r=Z(d,"DIV",{id:!0,class:!0});var S=x(r);i=fe(S,o),S.forEach(D),l=oe(d),s=Z(d,"DIV",{});var g=x(s);h=fe(g,u),g.forEach(D),k=oe(d),d.forEach(D),this.h()},h(){Y(r,"id",a=`for${e[15].reference}`),Y(r,"class","mr-4 cursor-pointer"),R(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),R(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),R(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),R(s,"opacity-30",e[15].progress===100&&e[15]!==e[1]),Y(n,"class","my-6 flex justify-between"),this.first=n},m(y,d){L(y,n,d),U(n,r),U(r,i),U(n,l),U(n,s),U(s,h),U(n,k),c||(f=ye(r,"click",p),c=!0)},p(y,d){e=y,d&1&&o!==(o=e[15].label+"")&&Fe(i,o),d&1&&a!==(a=`for${e[15].reference}`)&&Y(r,"id",a),d&3&&R(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),d&3&&R(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),d&3&&R(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),d&1&&u!==(u=e[15].startCharacter+"")&&Fe(h,u),d&3&&R(s,"opacity-30",e[15].progress===100&&e[15]!==e[1])},d(y){y&&D(n),c=!1,f()}}}function Fi(t){let e,n,r,o,i,a,l,s,u,h,k,c,f=[],p=new Map,y,d,S,g,C,w,q,A,I,j;h=new Ve({props:{icon:Io}});let N=t[0];const J=m=>m[15].reference;for(let m=0;m<N.length;m+=1){let E=Fn(t,N,m),v=J(E);p.set(v,f[m]=Dn(v,E))}return g=new Ve({props:{icon:To}}),q=new Ve({props:{icon:Ao}}),{c(){e=Q("div"),n=Q("div"),r=ue("Chapter Progress: "),o=ue(t[2]),i=ue(" ("),a=ue(t[3]),l=ue("%)"),s=ne(),u=Q("div"),me(h.$$.fragment),k=ne(),c=Q("div");for(let m=0;m<f.length;m+=1)f[m].c();y=ne(),d=Q("div"),S=Q("div"),me(g.$$.fragment),C=ne(),w=Q("div"),me(q.$$.fragment),this.h()},l(m){e=Z(m,"DIV",{class:!0});var E=x(e);n=Z(E,"DIV",{});var v=x(n);r=fe(v,"Chapter Progress: "),o=fe(v,t[2]),i=fe(v," ("),a=fe(v,t[3]),l=fe(v,"%)"),v.forEach(D),s=oe(E),u=Z(E,"DIV",{class:!0});var T=x(u);ge(h.$$.fragment,T),T.forEach(D),E.forEach(D),k=oe(m),c=Z(m,"DIV",{class:!0});var z=x(c);for(let G=0;G<f.length;G+=1)f[G].l(z);z.forEach(D),y=oe(m),d=Z(m,"DIV",{class:!0});var W=x(d);S=Z(W,"DIV",{class:!0});var O=x(S);ge(g.$$.fragment,O),O.forEach(D),C=oe(W),w=Z(W,"DIV",{class:!0});var te=x(w);ge(q.$$.fragment,te),te.forEach(D),W.forEach(D),this.h()},h(){Y(u,"class","cursor-pointer"),Y(e,"class","flex justify-between p-4"),Y(c,"class","flex-1 overflow-auto p-4"),Y(S,"class","cursor-pointer"),R(S,"opacity-30",!t[5]),Y(w,"class","cursor-pointer"),R(w,"opacity-30",!t[4]),Y(d,"class","flex justify-between px-4 py-6")},m(m,E){L(m,e,E),U(e,n),U(n,r),U(n,o),U(n,i),U(n,a),U(n,l),U(e,s),U(e,u),ke(h,u,null),L(m,k,E),L(m,c,E);for(let v=0;v<f.length;v+=1)f[v].m(c,null);L(m,y,E),L(m,d,E),U(d,S),ke(g,S,null),U(d,C),U(d,w),ke(q,w,null),A=!0,I||(j=[ye(u,"click",t[11]),ye(S,"click",t[13]),ye(w,"click",t[14])],I=!0)},p(m,[E]){(!A||E&4)&&Fe(o,m[2]),(!A||E&8)&&Fe(a,m[3]),E&131&&(N=m[0],f=vo(f,E,J,1,m,N,p,c,Co,Dn,null,Fn)),E&32&&R(S,"opacity-30",!m[5]),E&16&&R(w,"opacity-30",!m[4])},i(m){A||(X(h.$$.fragment,m),X(g.$$.fragment,m),X(q.$$.fragment,m),A=!0)},o(m){K(h.$$.fragment,m),K(g.$$.fragment,m),K(q.$$.fragment,m),A=!1},d(m){m&&D(e),pe(h),m&&D(k),m&&D(c);for(let E=0;E<f.length;E+=1)f[E].d();m&&D(y),m&&D(d),pe(g),pe(q),I=!1,Ct(j)}}}function Di(t,e){const[n,r]=e.reduce((o,i,a)=>(o[0]+=t[a]*i,o[1]+=i,o),[0,0]);return n/r}function Bn(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Bi(t,e,n){let r,o,{sectionData:i=[]}=e,{exploredCharCount:a=0}=e,l=[],s,u=-1,h="0/0",k="0.00";Rn(()=>{kn.dialogs$.next([{component:"<div/>"}]),s&&Bn(document.getElementById(`for${s.reference}`))});function c(g,C){if(g){const w=l[u+C];f(w.reference,!1)}}function f(g,C=!1){yt.next(g),C&&(et.next(!1),kn.dialogs$.next([]))}const p=()=>et.next(!1),y=g=>f(g.reference,!0),d=()=>c(r,-1),S=()=>c(o,1);return t.$$set=g=>{"sectionData"in g&&n(8,i=g.sectionData),"exploredCharCount"in g&&n(9,a=g.exploredCharCount)},t.$$.update=()=>{if(t.$$.dirty&1280&&i){const[g,C,w]=$n(i),q=i.filter(A=>A.reference===w||A.parentChapter===w);n(3,k=Di(q.map(A=>A.progress),q.map(A=>A.charactersWeight)).toFixed(2)),n(0,l=g),n(10,u=C),n(1,s=g[u])}if(t.$$.dirty&1024&&n(5,r=!!u),t.$$.dirty&1025&&n(4,o=u<l.length-1),t.$$.dirty&514&&s){Bn(document.getElementById(`for${s.reference}`));const g=s.characters;n(2,h=`${Math.min(Math.max(a-s.startCharacter,0),g)} / ${g}`)}},[l,s,h,k,o,r,c,f,i,a,u,p,y,d,S]}class Ei extends Je{constructor(e){super(),Qe(this,e,Bi,Fi,Ze,{sectionData:8,exploredCharCount:9})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ii(t,e){return Ti(t).pipe(we(n=>{const r=e.createElement("div");return r.innerHTML=n,Ai(r),qi(r),Vi(r,e),zi(r),r.innerHTML}))}function Ti(t){return new Ye(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(cr(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function Ai(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:Wn(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function qi(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Vi(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!Wn(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function zi(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Oi=oo;function oo(t,e,n){t instanceof RegExp&&(t=En(t,n)),e instanceof RegExp&&(e=En(e,n));const r=ro(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function En(t,e){const n=e.match(t);return n?n[0]:null}oo.range=ro;function ro(t,e,n){let r,o,i,a,l,s=n.indexOf(t),u=n.indexOf(e,s+1),h=s;if(s>=0&&u>0){if(t===e)return[s,u];for(r=[],i=n.length;h>=0&&!l;)h===s?(r.push(h),s=n.indexOf(t,h+1)):r.length===1?l=[r.pop(),u]:(o=r.pop(),o<i&&(i=o,a=u),u=n.indexOf(e,h+1)),h=s<u&&s>=0?s:u;r.length&&(l=[i,a])}return l}function Ri(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(v){throw new Error(`CSS parse error: ${v}`)}function a(v){const T=v.exec(t);if(T)return t=t.slice(T[0].length),T}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function h(){if(u(),t[0]!=="/"||t[1]!=="*")return;let v=2;for(;t[v]&&(t[v]!=="*"||t[v+1]!=="/");)v++;if(!t[v])return i("end of comment is missing");const T=t.slice(2,v);return t=t.slice(v+2),{type:"comment",comment:T}}function k(){const v=[];let T;for(;T=h();)v.push(T);return r.removeComments?[]:v}function c(){for(u();t[0]==="}";)i("extra closing bracket");const v=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(v)return v[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(T){return T.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(T){return T.replace(/\u200C/g,",")})}function f(){if(t[0]==="@")return J();a(/^([;\s]*)+/);const v=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let T=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!T)return;if(T=T[0].trim(),!a(/^:\s*/))return i("property missing ':'");const z=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),W={type:"declaration",property:T.replace(v,""),value:z?z[0].replace(v,"").trim():""};return a(/^[;\s]*/),W}function p(){if(!l())return i("missing '{'");let v,T=k();for(;v=f();)T.push(v),T=T.concat(k());return s()?T:i("missing '}'")}function y(){u();const v=[];let T;for(;T=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)v.push(T[1]),a(/^,\s*/);if(v.length)return{type:"keyframe",values:v,declarations:p()}}function d(){let v=a(/^@([-\w]+)?keyframes\s*/);if(!v)return;const T=v[1];if(v=a(/^([-\w]+)\s*/),!v)return i("@keyframes missing name");const z=v[1];if(!l())return i("@keyframes missing '{'");let W,O=k();for(;W=y();)O.push(W),O=O.concat(k());return s()?{type:"keyframes",name:z,vendor:T,keyframes:O}:i("@keyframes missing '}'")}function S(){if(a(/^@page */)){const T=c()||[];return{type:"page",selectors:T,declarations:p()}}}function g(){const v=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(v){const T=`${v[1]}-${v[2]}`+(v[3]?`-${v[3]}`:"");return{type:"page-margin-box",name:T,declarations:p()}}}function C(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:p()}}function w(){const v=a(/^@supports *([^{]+)/);if(v)return{type:"supports",supports:v[1].trim(),rules:E()}}function q(){if(a(/^@host\s*/))return{type:"host",rules:E()}}function A(){const v=a(/^@media([^{]+)*/);if(v)return{type:"media",media:(v[1]||"").trim(),rules:E()}}function I(){const v=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(v)return{type:"custom-media",name:v[1].trim(),media:v[2].trim()}}function j(){const v=a(/^@([-\w]+)?document *([^{]+)/);if(v)return{type:"document",document:v[2].trim(),vendor:v[1]?v[1].trim():null,rules:E()}}function N(){const v=a(/^@(import|charset|namespace)\s*([^;]+);/);if(v)return{type:v[1],name:v[2].trim()}}function J(){if(u(),t[0]==="@"){const v=N()||C()||A()||d()||w()||j()||I()||q()||S()||g();if(v&&!r.preserveStatic){let T=!1;return v.declarations?T=v.declarations.some(z=>/var\(/.test(z.value)):T=(v.keyframes||v.rules||[]).some(W=>(W.declarations||[]).some(O=>/var\(/.test(O.value))),T?v:{}}return v}}function m(){if(!r.preserveStatic){const z=Oi("{","}",t);if(z){const W=/:(?:root|host)(?![.:#(])/.test(z.pre)&&/--\S*\s*:/.test(z.body),O=/var\(/.test(z.body);if(!W&&!O)return t=t.slice(z.end+1),{}}}const v=c()||[],T=r.preserveStatic?p():p().filter(z=>{const W=v.some(te=>/:(?:root|host)(?![.:#(])/.test(te))&&/^--\S/.test(z.property),O=/var\(/.test(z.value);return W||O});return v.length||i("selector missing"),{type:"rule",selectors:v,declarations:T}}function E(v){if(!v&&!l())return i("missing '{'");let T,z=k();for(;t.length&&(v||t[0]!=="}")&&(T=J()||m());)T.type&&z.push(T),z=z.concat(k());return!v&&!s()?i("missing '}'"):z}return{type:"stylesheet",stylesheet:{rules:E(!0),errors:o}}}function Li(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const s=i[l];n&&n(s);const u=r[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const ji=/\s?html\s?/gi,Ni=/\s?body\s?/gi;function Gi(t,e){const r=Ri(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>ji.test(i)||Ni.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new Yi(o.declarations,i);o.declarations.forEach(l=>{Qt(i,Xi(l)),Qt(i,Wi(l)),Qt(i,a.convert(l))}),Object.entries(i).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(Ki()),r.forEach(o=>{o.selectors=Hi(o.selectors,e)}),Li({stylesheet:{rules:r},type:"stylesheet"})}function Hi(t,e){return t.map(n=>`${e} ${n}`)}function Qt(t,e){return e&&(t[e.key]=e.value),t}function Xi(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function Wi(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class Yi{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function Ki(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ui(t,e,n){return Ii(t,n).pipe(we(r=>({htmlContent:r,styleSheet:Gi(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ji(t){return new Ye(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Dt(t=Kn){return e=>t?e:Qn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function In(t,e,n){return r=>new Ye(o=>{const i=t();return r.pipe(jn(Gt),hr(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Qi(t,e,n,r,o,i,a,l,s){switch(e[t.code]){case He.BOOKMARK:return n(),!0;case He.JUMP_TO_BOOKMARK:return r(),!0;case He.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case He.AUTO_SCROLL_INCREASE:return o(1),!0;case He.AUTO_SCROLL_DECREASE:return o(-1),!0;case He.NEXT_PAGE:return a==null||a.nextPage(),!0;case He.PREV_PAGE:return a==null||a.prevPage(),!0;case He.PREV_CHAPTER:return s(l?1:-1),!0;case He.NEXT_CHAPTER:return s(l?-1:1),!0;default:return!1}}const{document:Zt}=On;function Tn(t){var k;let e,n,r,o,i,a,l,s;function u(c){t[54](c)}let h={hasChapterData:!!((k=t[10])!=null&&k.length),showFullscreenButton:It.fullscreenEnabled,autoScrollMultiplier:t[14]};return t[3]!==void 0&&(h.isBookmarkScreen=t[3]),n=new Pi({props:h}),ae.push(()=>he(n,"isBookmarkScreen",u)),n.$on("tocClick",t[55]),n.$on("fullscreenClick",t[52]),n.$on("bookmarkClick",t[50]),n.$on("bookManagerClick",t[51]),n.$on("settingsClick",t[50]),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(c){e=Z(c,"DIV",{class:!0});var f=x(e);ge(n.$$.fragment,f),f.forEach(D),this.h()},h(){Y(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(c,f){L(c,e,f),ke(n,e,null),a=!0,l||(s=an(o=Yn.call(null,e,t[56])),l=!0)},p(c,f){var y;t=c;const p={};f[0]&1024&&(p.hasChapterData=!!((y=t[10])!=null&&y.length)),f[0]&16384&&(p.autoScrollMultiplier=t[14]),!r&&f[0]&8&&(r=!0,p.isBookmarkScreen=t[3],de(()=>r=!1)),n.$set(p),o&&_o(o.update)&&f[0]&4&&o.update.call(null,t[56])},i(c){a||(X(n.$$.fragment,c),c&&Ln(()=>{i||(i=hn(e,$t,{y:-300,easing:xt},!0)),i.run(1)}),a=!0)},o(c){K(n.$$.fragment,c),c&&(i||(i=hn(e,$t,{y:-300,easing:xt},!1)),i.run(0)),a=!1},d(c){c&&D(e),pe(n),c&&i&&i.end(),l=!1,s()}}}function Zi(t){var r;let e=((r=t[36])!=null?r:"")+"",n;return{c(){n=ue(e)},l(o){n=fe(o,e)},m(o,i){L(o,n,i)},p(o,i){var a;i[1]&32&&e!==(e=((a=o[36])!=null?a:"")+"")&&Fe(n,e)},i:lt,o:lt,d(o){o&&D(n)}}}function xi(t){var v,T,z,W,O,te,G,ee;let e,n,r,o,i,a,l,s,u,h,k,c=((v=t[33])!=null?v:"")+"",f,p,y=((T=t[34])!=null?T:"")+"",d,S,g=((z=t[35])!=null?z:"")+"",C,w;e=new yi({props:{styleSheet:t[15].styleSheet}});function q(M){t[57](M)}function A(M){t[58](M)}function I(M){t[59](M)}function j(M){t[60](M)}function N(M){t[61](M)}function J(M){t[62](M)}function m(M){t[63](M)}let E={htmlContent:t[15].htmlContent,width:(W=t[16])!=null?W:0,height:(O=t[17])!=null?O:0,verticalMode:t[11],fontColor:(te=t[18])==null?void 0:te.fontColor,backgroundColor:t[19],hintFuriganaFontColor:(G=t[18])==null?void 0:G.hintFuriganaFontColor,hintFuriganaShadowColor:(ee=t[18])==null?void 0:ee.hintFuriganaShadowColor,fontSize:t[20],fontFamilyGroupOne:t[21],fontFamilyGroupTwo:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],viewMode:t[26],secondDimensionMaxValue:t[27],firstDimensionMargin:t[28],autoPositionOnResize:t[29],avoidPageBreak:t[30],pageColumns:t[31],autoBookmark:t[32],multiplier:t[14]};return t[5]!==void 0&&(E.exploredCharCount=t[5]),t[6]!==void 0&&(E.bookCharCount=t[6]),t[3]!==void 0&&(E.isBookmarkScreen=t[3]),t[9]!==void 0&&(E.bookmarkData=t[9]),t[0]!==void 0&&(E.autoScroller=t[0]),t[7]!==void 0&&(E.bookmarkManager=t[7]),t[8]!==void 0&&(E.pageManager=t[8]),r=new Ci({props:E}),ae.push(()=>he(r,"exploredCharCount",q)),ae.push(()=>he(r,"bookCharCount",A)),ae.push(()=>he(r,"isBookmarkScreen",I)),ae.push(()=>he(r,"bookmarkData",j)),ae.push(()=>he(r,"autoScroller",N)),ae.push(()=>he(r,"bookmarkManager",J)),ae.push(()=>he(r,"pageManager",m)),r.$on("bookmark",t[50]),{c(){me(e.$$.fragment),n=ne(),me(r.$$.fragment),k=ne(),f=ue(c),p=ne(),d=ue(y),S=ne(),C=ue(g)},l(M){ge(e.$$.fragment,M),n=oe(M),ge(r.$$.fragment,M),k=oe(M),f=fe(M,c),p=oe(M),d=fe(M,y),S=oe(M),C=fe(M,g)},m(M,V){ke(e,M,V),L(M,n,V),ke(r,M,V),L(M,k,V),L(M,f,V),L(M,p,V),L(M,d,V),L(M,S,V),L(M,C,V),w=!0},p(M,V){var Ce,se,Se,ce,ve,De,Be,Me;const le={};V[0]&32768&&(le.styleSheet=M[15].styleSheet),e.$set(le);const H={};V[0]&32768&&(H.htmlContent=M[15].htmlContent),V[0]&65536&&(H.width=(Ce=M[16])!=null?Ce:0),V[0]&131072&&(H.height=(se=M[17])!=null?se:0),V[0]&2048&&(H.verticalMode=M[11]),V[0]&262144&&(H.fontColor=(Se=M[18])==null?void 0:Se.fontColor),V[0]&524288&&(H.backgroundColor=M[19]),V[0]&262144&&(H.hintFuriganaFontColor=(ce=M[18])==null?void 0:ce.hintFuriganaFontColor),V[0]&262144&&(H.hintFuriganaShadowColor=(ve=M[18])==null?void 0:ve.hintFuriganaShadowColor),V[0]&1048576&&(H.fontSize=M[20]),V[0]&2097152&&(H.fontFamilyGroupOne=M[21]),V[0]&4194304&&(H.fontFamilyGroupTwo=M[22]),V[0]&8388608&&(H.hideSpoilerImage=M[23]),V[0]&16777216&&(H.hideFurigana=M[24]),V[0]&33554432&&(H.furiganaStyle=M[25]),V[0]&67108864&&(H.viewMode=M[26]),V[0]&134217728&&(H.secondDimensionMaxValue=M[27]),V[0]&268435456&&(H.firstDimensionMargin=M[28]),V[0]&536870912&&(H.autoPositionOnResize=M[29]),V[0]&1073741824&&(H.avoidPageBreak=M[30]),V[1]&1&&(H.pageColumns=M[31]),V[1]&2&&(H.autoBookmark=M[32]),V[0]&16384&&(H.multiplier=M[14]),!o&&V[0]&32&&(o=!0,H.exploredCharCount=M[5],de(()=>o=!1)),!i&&V[0]&64&&(i=!0,H.bookCharCount=M[6],de(()=>i=!1)),!a&&V[0]&8&&(a=!0,H.isBookmarkScreen=M[3],de(()=>a=!1)),!l&&V[0]&512&&(l=!0,H.bookmarkData=M[9],de(()=>l=!1)),!s&&V[0]&1&&(s=!0,H.autoScroller=M[0],de(()=>s=!1)),!u&&V[0]&128&&(u=!0,H.bookmarkManager=M[7],de(()=>u=!1)),!h&&V[0]&256&&(h=!0,H.pageManager=M[8],de(()=>h=!1)),r.$set(H),(!w||V[1]&4)&&c!==(c=((De=M[33])!=null?De:"")+"")&&Fe(f,c),(!w||V[1]&8)&&y!==(y=((Be=M[34])!=null?Be:"")+"")&&Fe(d,y),(!w||V[1]&16)&&g!==(g=((Me=M[35])!=null?Me:"")+"")&&Fe(C,g)},i(M){w||(X(e.$$.fragment,M),X(r.$$.fragment,M),w=!0)},o(M){K(e.$$.fragment,M),K(r.$$.fragment,M),w=!1},d(M){pe(e,M),M&&D(n),pe(r,M),M&&D(k),M&&D(f),M&&D(p),M&&D(d),M&&D(S),M&&D(C)}}}function An(t){let e,n,r,o,i,a,l;return n=new Ei({props:{sectionData:t[10],exploredCharCount:t[5]}}),{c(){e=Q("div"),me(n.$$.fragment),this.h()},l(s){e=Z(s,"DIV",{class:!0});var u=x(e);ge(n.$$.fragment,u),u.forEach(D),this.h()},h(){var s;Y(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),B(e,"color",(s=t[18])==null?void 0:s.fontColor,!1),B(e,"background-color",t[19],!1)},m(s,u){L(s,e,u),ke(n,e,null),i=!0,a||(l=an(r=Yn.call(null,e,t[64])),a=!0)},p(s,u){var k;t=s;const h={};u[0]&1024&&(h.sectionData=t[10]),u[0]&32&&(h.exploredCharCount=t[5]),n.$set(h),u[0]&262144&&B(e,"color",(k=t[18])==null?void 0:k.fontColor,!1),u[0]&524288&&B(e,"background-color",t[19],!1)},i(s){i||(X(n.$$.fragment,s),s&&(o||Ln(()=>{o=yo(e,$t,{x:-100,duration:100,easing:xt}),o.start()})),i=!0)},o(s){K(n.$$.fragment,s),i=!1},d(s){s&&D(e),pe(n),a=!1,l()}}}function qn(t){let e,n,r,o,i,a=(t[5]/t[6]*100).toFixed(2)+"",l,s;return{c(){e=Q("div"),n=ue(t[5]),r=ue(" / "),o=ue(t[6]),i=ue(" ("),l=ue(a),s=ue("%)"),this.h()},l(u){e=Z(u,"DIV",{class:!0});var h=x(e);n=fe(h,t[5]),r=fe(h," / "),o=fe(h,t[6]),i=fe(h," ("),l=fe(h,a),s=fe(h,"%)"),h.forEach(D),this.h()},h(){var u;Y(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),B(e,"color",(u=t[18])==null?void 0:u.tooltipTextFontColor,!1)},m(u,h){L(u,e,h),U(e,n),U(e,r),U(e,o),U(e,i),U(e,l),U(e,s)},p(u,h){var k;h[0]&32&&Fe(n,u[5]),h[0]&64&&Fe(o,u[6]),h[0]&96&&a!==(a=(u[5]/u[6]*100).toFixed(2)+"")&&Fe(l,a),h[0]&262144&&B(e,"color",(k=u[18])==null?void 0:k.tooltipTextFontColor,!1)},d(u){u&&D(e)}}}function $i(t){var j,N,J;let e,n,r=((j=t[13])!=null?j:"")+"",o,i,a,l,s,u,h,k,c,f,p,y,d,S;Zt.title=e=dn((J=(N=t[12])==null?void 0:N.title)!=null?J:"");let g=t[2]&&Tn(t);const C=[xi,Zi],w=[];function q(m,E){return m[15]?0:1}u=q(t),h=w[u]=C[u](t);let A=t[1]&&An(t),I=t[4]&&t[6]&&qn(t);return{c(){n=ne(),o=ue(r),i=ne(),a=Q("button"),l=ne(),g&&g.c(),s=ne(),h.c(),k=ne(),A&&A.c(),c=ne(),I&&I.c(),f=ne(),p=Q("button"),this.h()},l(m){wo('[data-svelte="svelte-rnuhm6"]',Zt.head).forEach(D),n=oe(m),o=fe(m,r),i=oe(m),a=Z(m,"BUTTON",{class:!0}),x(a).forEach(D),l=oe(m),g&&g.l(m),s=oe(m),h.l(m),k=oe(m),A&&A.l(m),c=oe(m),I&&I.l(m),f=oe(m),p=Z(m,"BUTTON",{class:!0}),x(p).forEach(D),this.h()},h(){Y(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),Y(p,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(m,E){L(m,n,E),L(m,o,E),L(m,i,E),L(m,a,E),L(m,l,E),g&&g.m(m,E),L(m,s,E),w[u].m(m,E),L(m,k,E),A&&A.m(m,E),L(m,c,E),I&&I.m(m,E),L(m,f,E),L(m,p,E),y=!0,d||(S=[ye(window,"keydown",t[49]),ye(a,"click",t[53]),ye(p,"click",t[65])],d=!0)},p(m,E){var T,z,W;(!y||E[0]&4096)&&e!==(e=dn((z=(T=m[12])==null?void 0:T.title)!=null?z:""))&&(Zt.title=e),(!y||E[0]&8192)&&r!==(r=((W=m[13])!=null?W:"")+"")&&Fe(o,r),m[2]?g?(g.p(m,E),E[0]&4&&X(g,1)):(g=Tn(m),g.c(),X(g,1),g.m(s.parentNode,s)):g&&(Le(),K(g,1,1,()=>{g=null}),je());let v=u;u=q(m),u===v?w[u].p(m,E):(Le(),K(w[v],1,1,()=>{w[v]=null}),je(),h=w[u],h?h.p(m,E):(h=w[u]=C[u](m),h.c()),X(h,1),h.m(k.parentNode,k)),m[1]?A?(A.p(m,E),E[0]&2&&X(A,1)):(A=An(m),A.c(),X(A,1),A.m(c.parentNode,c)):A&&(Le(),K(A,1,1,()=>{A=null}),je()),m[4]&&m[6]?I?I.p(m,E):(I=qn(m),I.c(),I.m(f.parentNode,f)):I&&(I.d(1),I=null)},i(m){y||(X(g),X(h),X(A),y=!0)},o(m){K(g),K(h),K(A),y=!1},d(m){m&&D(n),m&&D(o),m&&D(i),m&&D(a),m&&D(l),g&&g.d(m),m&&D(s),w[u].d(m),m&&D(k),A&&A.d(m),m&&D(c),I&&I.d(m),m&&D(f),m&&D(p),d=!1,Ct(S)}}}const Vn="background-color",zn="writing-mode";function ea(t,e,n){let r,o,i,a,l,s,u,h,k,c,f,p,y,d,S,g,C,w,q,A,I,j,N,J,m,E,v,T;$(t,Ko,_=>n(11,o=_)),$(t,et,_=>n(1,i=_)),$(t,Jt,_=>n(14,s=_)),$(t,Uo,_=>n(20,p=_)),$(t,Jo,_=>n(21,y=_)),$(t,Qo,_=>n(22,d=_)),$(t,Zo,_=>n(23,S=_)),$(t,xo,_=>n(24,g=_)),$(t,$o,_=>n(25,C=_)),$(t,er,_=>n(26,w=_)),$(t,tr,_=>n(27,q=_)),$(t,nr,_=>n(28,A=_)),$(t,or,_=>n(29,I=_)),$(t,rr,_=>n(30,j=_)),$(t,ir,_=>n(31,N=_)),$(t,ar,_=>n(32,J=_));let z=!0,W=!1,O=!0,te=0,G=0,ee,M,V,le=Promise.resolve(void 0);const H=Ht(2500).pipe(Ue(()=>n(2,z=!1)),ot());$(t,H,_=>n(13,l=_));const Ce=mt(()=>Ji(qo)).pipe(we(_=>Number(_.url.searchParams.get("id"))),nn({refCount:!0,bufferSize:1})),se=Ce.pipe(pt(_=>Mt.getData(_)),on());$(t,se,_=>n(12,a=_));const Se=se.pipe(Ue(_=>{_||Wo("/manage")}),ot());$(t,Se,_=>n(36,T=_));const ce=se.pipe(Ue(_=>{!_||n(9,le=Mt.getBookmark(_.id))}),ot());$(t,ce,_=>n(33,m=_));const ve=se.pipe(pt(_=>_?(sn.next(_.sections||[]),Ui(_,".book-content",document)):kt),nn({refCount:!0,bufferSize:1}));$(t,ve,_=>n(15,u=_));const De=mt(()=>We(visualViewport,"resize")).pipe(on()),Be=De.pipe(tn(0),we(()=>visualViewport.width),Dt());$(t,Be,_=>n(16,h=_));const Me=De.pipe(tn(0),we(()=>visualViewport.height),Dt());$(t,Me,_=>n(17,k=_));const _e=Ho.pipe(we(_=>dr.get(_)),jt(_=>!!_));$(t,_e,_=>n(18,c=_));const be=_e.pipe(we(_=>_.backgroundColor));$(t,be,_=>n(19,f=_));const ze=be.pipe(In(()=>document.body,(_,Ae)=>Ae.style.setProperty(Vn,_),_=>_.style.removeProperty(Vn)),ot(),Dt());$(t,ze,_=>n(34,E=_));const Oe=Xo.pipe(In(()=>document.documentElement,(_,Ae)=>Ae.style.setProperty(zn,_),_=>_.style.removeProperty(zn)),ot(),Dt());$(t,Oe,_=>n(35,v=_));const Te=mt(()=>zt).pipe(we(_=>[..._.values()]));$(t,Te,_=>n(10,r=_));function xe(_){!Qi(_,Yo.getValue(),Ne,$e,ut=>Jt.next(Jt.getValue()+ut),ee,V,o,F)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),_.preventDefault())}function Ke(){let _;return Ce.subscribe(Ae=>_=Ae).unsubscribe(),_}async function Ne(){const _=Ke();if(!_||!M)return;const Ae=M.formatBookmarkData(_);await Mt.putBookmark(Ae),n(9,le=Promise.resolve(Ae))}async function $e(){const _=await le;!_||!M||M.scrollToBookmark(_)}function P(){Mt.deleteLastItem(),Ne()}function re(){if(!It.fullscreenElement){It.requestFullscreen(document.documentElement);return}It.exitFullscreen()}function F(_){if(!(r!=null&&r.length))return;const[Ae,ut]=$n(r);!ut&&_===-1||_===1&&ut===Ae.length-1||yt.next(Ae[ut+_].reference)}const ie=()=>n(2,z=!0);function Ge(_){W=_,n(3,W)}const Ee=()=>{n(2,z=!1),et.next(!0)},Re=()=>n(2,z=!1);function St(_){te=_,n(5,te)}function b(_){G=_,n(6,G)}function Wt(_){W=_,n(3,W)}function Yt(_){le=_,n(9,le)}function io(_){ee=_,n(0,ee)}function ao(_){M=_,n(7,M)}function lo(_){V=_,n(8,V)}const so=()=>et.next(!1),uo=()=>n(4,O=!O);return t.$$.update=()=>{t.$$.dirty[0]&3&&i&&(ee==null||ee.off())},[ee,i,z,W,O,te,G,M,V,le,r,o,a,l,s,u,h,k,c,f,p,y,d,S,g,C,w,q,A,I,j,N,J,m,E,v,T,H,se,Se,ce,ve,Be,Me,_e,be,ze,Oe,Te,xe,Ne,P,re,ie,Ge,Ee,Re,St,b,Wt,Yt,io,ao,lo,so,uo]}class ha extends Je{constructor(e){super(),Qe(this,e,ea,$i,Ze,{},null,[-1,-1,-1])}}export{ha as default};
